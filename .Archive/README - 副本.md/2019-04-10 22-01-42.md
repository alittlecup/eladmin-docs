
# 九、异常处理机制
## 9.1 后端异常处理
本系统封装了一些常用的异常处理类，并使用GlobalExceptionHandler类对异常进行统一处理，使用异常处理模块如下图：

![](https://i.loli.net/2019/03/28/5c9c945e998bc.png)

## 9.2 前端异常处理
在前端的 ```src/utils/request.js``` 文件中对所有的```request```请求进行拦截，通过 ```response``` 拦截器对接口返回的状态码进行分析与异常拦截
``` html
// response 拦截器
service.interceptors.response.use(
  response => {
    const code = response.status
    if (code < 200 || code > 300) {
      Notification.error({
        title: response.message
      })
      return Promise.reject('error')
    } else {
      return response.data
    }
  },
  error => {
    let code = 0
    try {
      code = error.response.data.status
    } catch (e) {
      if (error.toString().indexOf('timeout')) {
        Notification.error({
          title: '请求超时',
          duration: 2500
        })
        return Promise.reject(error)
      }
    }
    if (code === 401) {
      MessageBox.confirm(
        '登录状态已失效，你可以取消继续留在该页面，或者重新登录',
        '提示',
        {
          confirmButtonText: '重新登录',
          cancelButtonText: '取消',
          type: 'warning'
        }
      ).then(() => {
        store.dispatch('LogOut').then(() => {
          location.reload() // 为了重新实例化vue-router对象 避免bug
        })
      })
    } else if (code === 403) {
      router.push({ path: '/401' })
    } else {
      const errorMsg = error.response.data.message
      if (errorMsg !== undefined) {
        Notification.error({
          title: errorMsg,
          duration: 2500
        })
      }
    }
    return Promise.reject(error)
  }
)
```

# 十、系统工具类
系统常用工具类位于 eladmin-common 模块中的 utils 包下，具体作用如下：

## 10.1 ElAdminConstant
此工具类用户记录系统常用的静态常量
## 10.2 EncryptUtils
提供：Md5加密，对称加密，对称解密
## 10.3 FileUtil
```FileUtil``` 继承了 ```hutool```工具包中的 [FileUtil](http://hutool.mydoc.io/#text_319390)，并对其进行扩展，新增功能如下：
1. MultipartFile转File：	```toFile```
2. 获取文件扩展名：```getExtensionName```
3. 获取不带扩展名的文件名：```getFileNameNoEx```
4. 删除文件：```deleteFile```
5. 获取文件大小：```getSize```

## 10.4 ListSortUtil
List按照指定字段排序的工具类
## 10.5 PageUtil
系统分页工具类，对返回的数据进行处理
## 10.6 RequestHolder
随时获取 ```HttpServletRequest```
## 10.7 SecurityContextHolder（获取当前登录用户）
通过此工具类，可以直接获取当前登录的用户
## 10.8 SpringContextHolder
随时获取 ```spring bean```
## 10.9 StringUtils
```StringUtils``` 继承了 ```apache```工具包中的 ```StringUtils```，并对其进行扩展，新增功能如下：
1. 是否包含字符串：```inString```
2. 驼峰命名法工具：```toCamelCase、toCapitalizeCamelCase、toUnderScoreCase```具体查看源码
3. 获取ip地址：```getIP```
4. 获取当天是周几：```getWeekDay```

## 10.10 ThrowableUtil
异常工具，可获取异常堆栈信息

# 十一、代码生成功能
本系统提供高灵活度的代码生成功能，只需要在数据库中设计好表结构，就能一键生成前后端代码，是不是很nice，具体使用说明如下：

## 11.1 设计表结构
这一步很关键，也有需要注意的地方：
1. 特别注意、```主键需要设计成自增```
2. 设计字段是否为空
3. 设计注释，```前端会根据注释生成表格标题```

![](https://i.loli.net/2019/03/28/5c9c94747b040.png)

## 11.2 界面预览
我们数据库中表都能在这看到，并且根据自己的需要进行 ```生成器配置```

![](https://i.loli.net/2019/03/28/5c9c949238a5b.png)

## 11.3 生成器配置
命名有些```中二```，但是不影响他的实用性，相关说明如下

![](https://i.loli.net/2019/03/28/5c9c94a5899a2.png)

1. 至于包下：这个的意思是```生成的代码放到哪个包里面```
2. 模块名称：这个顾名思义就是模块的名称
3. 前端路径：前端代码生成的路径
4. API路径：这个默认至于 ```src/api``` 目录下
5. 是否覆盖：危险操作，需谨慎

## 11.4 代码生成
配置好生成器后就能进行代码生成啦，具体操作如下：
1. 点击生成代码按钮
2. 可以临时修改字段标题
3. 配置查询方式，可选：精确或者模糊
4. 列表显示：前端页面是否显示该字段，建议不要显示```ID```
5. 当然是点击生成按钮啦

![](https://i.loli.net/2019/03/28/5c9c94b9a8989.png)
## 11.5 额外的工作
代码生成可以节省你百分之```75```以上的开发任务，部分是需要自己需求进行修改的，如：
1. 添加菜单：虽然代码给你生成了，但是菜单还是需要自己手动添加的
2. 表单验证：前端代码没有表单验证，这个需要自己修改

## 11.6 预览
添加菜单后，生成的界面如下：<br>
1、搜索

![](https://i.loli.net/2019/03/28/5c9c94cec325d.png)

2、新增

![](https://i.loli.net/2019/03/28/5c9c94e967d00.png)

3、列表

![](https://i.loli.net/2019/03/28/5c9c94fd8d347.png)

# 十二、版本更新说明
## 2018年12月23日（v1.0）
这个版本是一个纯净的后台，当然也有挺多的bug
- 主要框架：spring boot+Spring Security+Redis
- 密码加密：采用MD5加盐加密
- 系统日志：使用aop保存操作日志
- 实体映射：使用MapStruct
- 前端菜单：支持动态路由

## 2018年12月25号（v1.1）
发布了第二个版本，也修复了v1.0中已知的bug

**新增功能**
-  实时控制台

**Bug修复**
-  修复菜单渲染根据soft字段排序
-  修复菜单部分字段不更新的bug
-  修复前端菜单面包屑导航点击无页面的bug

**细节优化**
-  优化站点统计，改为定时器方式每日0点重置站点访客信息
-  优化默认用户、角色、权限不可删除和修改

## 2018年12月28号（v1.2）
**新增**
- 邮箱工具
- SM.MS免费图床
- 富文本编辑器

**优化**
- 查询细节优化
- 后台接口权限细节优化
- 前端新增和修改按钮loading
- 前端请求超时异常处理
- 菜单sort字段拼写错误，由soft更正为sort
- 前端图标选择组件优化，加入滚动条
- 常用接口处理，前端将图片上传接口和实时控制台接口存入store->modules->api.js

**bug修复**
- 一级菜单无法渲染（后端）
- 修复用户存在多个角色时菜单获取失败（后端）
- 修复角色管理前缀为ROLE_，与spring security的默认前端冲突，导致无权限访问，解决办法：将角色管理的前缀改为ROLES_

## 2018年12月31号（v1.3）
**新增**
- 个人中心上线，修改密码功能，根据邮箱验证码修改邮箱功能，修改头像功能
- 七牛云存储
- 支付宝支付

**优化**
- 实时控制台异常堆栈信息打印
- 对403错误和401错误分开处理

## 2019年1月8号（v1.4）
该版本优化了前端，让form组件可以复用，为下个版本的代码生成做准备
**新增**
-  定时任务管理 整合quartz做定时任务

**调整与优化**
- 前端页面优化，表单组件复用
- 调整redis过期时间为2小时

**bug修复**
- 修复redis key过长时删除失败的问题
- 修复多级菜单渲染异常问题